$(function(){
	chart();
})
var data = {"cycq":{"x":[],"y":[]},"jycq":{"x":[],"y":[]},"hcczcq":{"x":[],"y":[]},"yycq":{"x":[],"y":[]}}
function chart(){
	var option1 = {
        title: {
            text: '抽样超期统计'            
        },
        tooltip: {
            trigger: 'axis'
        },
        /*legend: {
            data:['最低气温']
        },*/
        toolbox: {
            show: true,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                dataView: {readOnly: false},
                magicType: {type: ['line', 'bar']},
                restore: {},
                saveAsImage: {}
            }
        },
        grid: { // 控制图的大小，调整下面这些值就可以，
            x: 40,
            x2: 100,
            y2: 150// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
        },
        xAxis:  {
            type: 'category',
            boundaryGap: false,
            //data: ['抽样单位1','抽样单位2','抽样单位3','抽样单位4','抽样单位5','抽样单位6','抽样单位7']
            axisLabel: {
                formatter: function(value){
                    var ret = "";//拼接加\n返回的类目项
                    var maxLength = 2;//每项显示文字个数
                    var valLength = value.length;//X轴类目项的文字个数
                    var rowN = Math.ceil(valLength / maxLength); //类目项需要换行的行数
                    if (rowN > 1)//如果类目项的文字大于3,
                    {
                        for (var i = 0; i < rowN; i++) {
                            var temp = "";//每次截取的字符串
                            var start = i * maxLength;//开始截取的位置
                            var end = start + maxLength;//结束截取的位置
                            //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧
                            temp = value.substring(start, end) + "\n";
                            ret += temp; //凭借最终的字符串
                        }
                        return ret;
                    }
                    else {
                        return value;
                    }
                }
            },
            data: data["合肥"][0]["xAxis"][0]["data"]
        },
        yAxis: {
        	name:'数量',
            type: 'value',
            axisLabel: {
                formatter: '{value}批'
            },
            axisLine:{
                lineStyle:{
                    color:'#000'
                }
            }
        },
        series: [
            {
                name:'截止今天抽样超期数量',
                type:'bar',
                itemStyle: {
                    normal: {
                        // 随机显示
                        color:function(d){
                            return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);
                        }
                        //定制显示
                       /* color: function(params) {
                            // build a color map as your need.
                            var colorList = [
                                '#C1232B','#B5C334','#FCCE10','#E87C25','#27727B',
                                '#FE8463','#9BCA63','#FAD860','#F3A43B','#60C0DD',
                                '#D7504B','#C6E579','#F4E001','#F0805A','#26C0C0',
                                '#EFE42A','#C33531','#EE9201','#29AAE3','#64BD3D',
                                '#64BD3D','#0AAF9F','#26C0C0','#26C0C0','#26C0C0',
                                '#26C0C0','#26C0C0','#26C0C0','#26C0C0','#26C0C0',
                                '#26C0C0','#26C0C0','#26C0C0','#26C0C0','#26C0C0'
                            ];
                            return colorList[params.dataIndex]
                        }*/
                        ,
                        label: {
                            show: true
                           // position: 'top',
                           // formatter: '{b}\n{c}'
                        }
                    }
                },
                data:data["合肥"][0]["series"][0]["data"],
                markPoint: {
                    data: [
                        {name: '周最低', value: 0, xAxis: 1, yAxis: -1.5}
                    ]
                },
                markLine: {
                    data: [/*[
                          {
                              name:'5',
                              coord:[0,5]
                          },{
                              name:'',
                              coord:[6,5]
                          }
                        ],*/
                        [{
                            symbol: 'none',
                            x: '90%',
                            yAxis: 'max'
                        }, {
                            symbol: 'circle',
                            label: {
                                normal: {
                                    position: 'start',
                                    formatter: '最大值'
                                }
                            },
                            type: 'max',
                            name: '最高点'
                        }]
                    ]
                }
            }
        ]
    };
    var myChart1=echarts.init(document.getElementById('chart_1'));
    myChart1.setOption(option1);
    var option2 = {
        title: {
            text: '检验超期统计'            
        },
        tooltip: {
            trigger: 'axis'
        },
        toolbox: {
            show: true,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                dataView: {readOnly: false},
                magicType: {type: ['line', 'bar']},
                restore: {},
                saveAsImage: {}
            }
        },
        grid: { // 控制图的大小，调整下面这些值就可以，
                      x: 40,
                     x2: 100,
                     y2: 150// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
         },
        xAxis:  {
            type: 'category',
            boundaryGap: false,
            axisLabel: {
                interval: 0,
                formatter: function(value){
                    //debugger
                    var ret = "";//拼接加\n返回的类目项
                    var maxLength = 2;//每项显示文字个数
                    var valLength = value.length;//X轴类目项的文字个数
                    var rowN = Math.ceil(valLength / maxLength); //类目项需要换行的行数
                    if (rowN > 1)//如果类目项的文字大于3,
                    {
                        for (var i = 0; i < rowN; i++) {
                            var temp = "";//每次截取的字符串
                            var start = i * maxLength;//开始截取的位置
                            var end = start + maxLength;//结束截取的位置
                            //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧
                            temp = value.substring(start, end) + "\n";
                            ret += temp; //凭借最终的字符串
                        }
                        return ret;
                    }
                    else {
                        return value;
                    }
                }
            },
            data: data["合肥"][1]["xAxis"][0]["data"]
        },
        yAxis: {
        	name:'数量',
            type: 'value',
            axisLabel: {
                formatter: '{value}批'
            },
            axisLine:{
                lineStyle:{
                    color:'#000'
                }
            }
        },
        series: [
            {
                name:'截止今天检验超期数量',
                type:'bar',
                itemStyle: {
                      normal: {
                          // 随机显示
                          color:function(d){
                              return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);
                          },
                          label: {
                              show: true
                              // position: 'top',
                              // formatter: '{b}\n{c}'
                          }
                      }
                },
                data:data["合肥"][1]["series"][0]["data"],
                markPoint: {
                    data: [
                        {name: '周最低', value: 0, xAxis: 1, yAxis: -1.5}
                    ]
                }, 
                markLine: {
                    data: [
                        /*[
                          {
                              name:'25',
                              coord:[0,25]
                          },{
                              name:'25',
                              coord:[6,25]
                          }
                        ],*/
                        [{
                            symbol: 'none',
                            x: '90%',
                            yAxis: 'max'
                        }, {
                            symbol: 'circle',
                            label: {
                                normal: {
                                    position: 'start',
                                    formatter: '最大值'
                                }
                            },
                            type: 'max',
                            name: '最高点'
                        }]
                    ]
                }
            }
        ]
    };
    var myChart2=echarts.init(document.getElementById('chart_2'));
    myChart2.setOption(option2);
    var Info = {"x":['合肥','芜湖','蚌埠','淮南','马鞍山','淮北','铜陵','安庆','黄山','滁州','阜阳','宿州','六安市'],"y":{
        "hclq":[200, 140, 170, 230, 245, 176, 135, 162, 132, 120, 160, 130,140],
        "hcwc":[63, 35, 52, 88, 84, 43, 56, 50, 35, 73, 37, 94,42],
        "yycq":[6, 5, 5, 8, 4, 3, 6, 0, 5, 7, 17, 4,14]
        }};

    var option3 = {
        title: {
            text: '核查异议超期'
        },
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'cross',
                crossStyle: {
                    color: '#999'
                }
            }
        },
        toolbox: {
            feature: {
                dataView: {show: true, readOnly: false},
                magicType: {show: true, type: ['line', 'bar']},
                restore: {show: true},
                saveAsImage: {show: true}
            }
        },
        legend: {
            data:['核查领取超期','处置完成超期','异议登记超期']
        },
        xAxis: [
            {
                type: 'category',
                axisLabel: {
                    interval: 0,
                    formatter: function(value){
                        //debugger
                        var ret = "";//拼接加\n返回的类目项
                        var maxLength = 1;//每项显示文字个数
                        var valLength = value.length;//X轴类目项的文字个数
                        var rowN = Math.ceil(valLength / maxLength); //类目项需要换行的行数
                        if (rowN > 1)//如果类目项的文字大于3,
                        {
                            for (var i = 0; i < rowN; i++) {
                                var temp = "";//每次截取的字符串
                                var start = i * maxLength;//开始截取的位置
                                var end = start + maxLength;//结束截取的位置
                                //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧
                                temp = value.substring(start, end) + "\n";
                                ret += temp; //凭借最终的字符串
                            }
                            return ret;
                        }
                        else {
                            return value;
                        }
                    }
                },
                data: Info.x,
                axisPointer: {
                    type: 'shadow'
                }
            }
        ],
        yAxis: [
            {
                type: 'value',
                name: '超期数',
                min: 0,
                // max: 250,
                interval: 10,
                axisLabel: {
                    formatter: '{value} '
                }
            }
        ],
        series: [
            {
                name:'核查领取超期',
                type:'bar',
                itemStyle: {
                    normal: {
                        // 随机显示
                        color:function(d){
                            return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);
                        },
                        label: {
                            show: true
                            // position: 'top',
                            // formatter: '{b}\n{c}'
                        }
                    }
                },
                data:Info.y.hclq
            },
            {
                name:'处置完成超期',
                type:'bar',
                itemStyle: {
                    normal: {
                        // 随机显示
                        color:function(d){
                            return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);
                        },
                        label: {
                            show: true
                            // position: 'top',
                            // formatter: '{b}\n{c}'
                        }
                    }
                },
                data:Info.y.hcwc
            },
            {
                name:'异议登记超期',
                type:'bar',
                itemStyle: {
                    normal: {
                        // 随机显示
                        color:function(d){
                            return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);
                        },
                        label: {
                            show: true
                            // position: 'top',
                            // formatter: '{b}\n{c}'
                        }
                    }
                },
                data:Info.y.yycq
            }
        ]
    };

    var myChart3=echarts.init(document.getElementById('chart_3'))
    myChart3.setOption(option3);
    // 点击下拉框根据区域加载相应地区的数据
    // console.log($('.cqtj_option')[0].value);

        $(document).on('change','select#cqtj_option',function(){
            var optionVal=$(this).val();//获取当前选中项的value值
            getChartInfo(myChart1);
            getChartInfo(myChart2);
            //console.log(data);
            //myChart1.setOption(data[optionVal][0]);
            //myChart2.setOption(data[optionVal][1]);
            //switch(optionVal){
            //    case '黄山':
            //        myChart1.setOption(huangshan1);
            //        myChart2.setOption(huangshan2);
            //        break;
            //        case '蚌埠':
            //        myChart1.setOption(bengbu1);
            //        myChart2.setOption(bengbu2);
            //        break;
            //        case '合肥':
            //        myChart1.setOption(hefei1);
            //        myChart2.setOption(hefei2);
            //        break;
            //        default :
            //        break;
            //}          
        });
    //数据请求后台
    function getChartInfo(myChart,params){
        myChart.showLoading();
      /*  $.ajax({
       type : "post",
       async : true, //异步执行
       url : "AcceptData",
       dataType : "json", //返回数据形式为json
       success : function(json) {
       if (json) {
       var data;
       if(myChart==myChart1){
       data = json.cyjg;
       }else{
       data = json.cjjg;
       }*/
        myChart.hideLoading();
        myChart.setOption({
            xAxis:[{
                data:['抽样单位1','抽样单位2','抽样单位3','抽样单位4','抽样单位5','抽样单位6','抽样单位7']
            }],
            series:[
                {
                    data:[5, 2, 8, 5, 3, 1, 9]
                }
            ]
        });
      /*    }
       },
       error : function(errorMsg) {
       alert("请求数据失败");
       }*/
    }
    //点击不同的市显示相应的数据列表
    myChart1.on('click',function(params){
        switch(params.name){
            case '抽样单位1':
                var iTop = (window.screen.availHeight-400)/ 2;
                var iLeft = (window.screen.availWidth-800)/ 2;
                window.open('./chaoqiList.html', '_blank','height=400, width=1000, top='+iTop+',left='+iLeft+', toolbar=no,menubar=no, scrollbars=no,resizable=no, location=no, status=no');
                break;
        }
    })
}
