<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>抽样地点</title>
    <!-- css
    <link rel="stylesheet" href="../../libs/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/TreeGrid.css">
    <link rel="stylesheet" href="../../css/reset.css">
    <link rel="stylesheet" href="../../css/rwtj.css">
    -->
    <%= stylesheet_link_tag "statistics_old/bootstrap/dist/css/bootstrap.min.css", :media => "all" %>
    <%= stylesheet_link_tag "statistics_old/reset","statistics_old/rwtj","statistics_old/TreeGrid", :media => "all" %>
    <!-- js
    <script src="../../libs/treegrad/jquery-1.3.2.min.js"></script>
    <script src="../../libs/treegrad/TreeGrid.js"></script>
    <script src="../../libs/echarts.js"></script>
    -->
    <%= javascript_include_tag "statistics/treegrad/jquery-1.3.2.min","statistics/treegrad/TreeGrid" %>
</head>
<body>
    <!-- 抽样地点 -->
    <div class="sampbox" id="sampbox_sign">
        <!-- 上部 -->
        <div class="sampbox_topCon">
            <!-- 左侧选取栏 -->
            <label for="sampbox_option">筛选条件</label>
            <select class="form-control sampbox_option" id="sampbox_option">
                <option selected="selected">全部</option>
                <option>生产</option>
                <option>流通</option>
                <option>餐饮</option>
            </select>
        </div>
        <!-- 查询导出操作按钮 -->
        <div class="taskbtn_operBox">
            <button type="submit" class="btn btn-default taskbtn_query">查询</button>
            <button type="submit" class="btn btn-default taskbtn_export bgc1 btn-primary">导出列表</button>
        </div>
        <!-- 注释说明 -->
        <p style="margin:10px; color: red;font-size: 14px;">说明：省市县管理员进去该统计，区域显示不同，如省管理员看到各市信息，以此类推。进入显示该区域下的数据，县级只显示自己数据。</p>
        <!-- 下部 -->
        <!-- 表格数据 -->
        <div id="sampbox_bottomCon" style="margin-bottom: 100px;margin-top: 30px;">
            <!-- 动态加载数据 -->
        </div>
        <script type="text/javascript">
            var config = {
                id: "tg1",
                width: "100%",
                renderTo: "sampbox_bottomCon",
                headerAlign: "left",
                headerHeight: "30",
                dataAlign: "left",
                indentation: "20",
                folderOpenIcon: "<%= asset_path('statistics/page-open.png') %>",
                folderCloseIcon: "<%= asset_path('statistics/page-close.png') %>",
                defaultLeafIcon: "<%= asset_path('statistics/page-none.png') %>", 
                hoverRowBackground: "false",
                folderColumnIndex: "0",
                itemClick: "itemClickEvent",
                columns:[
                    {headerText: "区域", dataField: "name", headerAlign: "center",width: "200", handler: "customOrgName"},
                    {headerText: "任务数", dataField: "task", headerAlign: "center", dataAlign: "center",width: "100",},
                    {headerText: "抽样数",dataField: "sampling", headerAlign: "center", dataAlign: "center", width: "100"},
                    {headerText: "检验数", dataField: "test",headerAlign: "center", dataAlign: "center", width: "100"},
                    {headerText: "不合格数", dataField: "unqualified",headerAlign: "center", dataAlign: "center", width: "100"},
                    {headerText: "合格数", dataField: "qualified",headerAlign: "center", dataAlign: "center", width: "100"},
                    {headerText: "已处置", dataField: "Disposed",headerAlign: "center", dataAlign: "center", width: "100"},
                    {headerText: "处置中", dataField: "Disposal",headerAlign: "center", dataAlign: "center", width: "100"}
                ],
                data:[
                    {name: "合肥",task:"50",sampling:"500",test:"250",unqualified:"12",qualified:"238",Disposed:"7",Disposal:"5",children:[
                        {name: "瑶海",task:"10",sampling:"100",test:"50",unqualified:"2",qualified:"48",Disposed:"1",Disposal:"1",},
                        {name: "庐阳",task:"20",sampling:"200",test:"100",unqualified:"5",qualified:"95",Disposed:"3",Disposal:"2",},
                        {name: "蜀山",task:"20",sampling:"200",test:"100",unqualified:"5",qualified:"95",Disposed:"3",Disposal:"2",},
                        ]},
                    {name: "黄山",task:"20",sampling:"200",test:"100",unqualified:"5",qualified:"95",Disposed:"3",Disposal:"2",},
                    {name: "芜湖",task:"10",sampling:"100",test:"50",unqualified:"2",qualified:"48",Disposed:"1",Disposal:"1",},
                    {name: "合计：",task:"80",sampling:"800",test:"400",unqualified:"19",qualified:"381",Disposed:"11",Disposal:"8",},
                ]
            };

            $(document).ready(function(){
                $("#sampbox_bottomCon table tr:last td:first").children("img").remove(); //删除最后图标
                $(".allcheck").click(function(){
                    $("#tg1").find("input[name='cblbox']").attr("checked",$(this).attr("checked"));
                });

            });
            /*
                单击数据行后触发该事件
                id：行的id
                index：行的索引。
                data：json格式的行数据对象。
            */
            function itemClickEvent(id, index, data){


                jQuery("#currentRow").val(id + ", " + index + ", " + TreeGrid.json2str(data));
            }

            /*
                通过指定的方法来自定义栏数据
            */
            function customCheckBox(row, col){
                return "<input name='cblbox' type='checkbox'>";
            }

            function customOrgName(row, col){
                var name = row[col.dataField] || "";
                return name;
            }

            function customLook(row, col){

                return "<a href='javascript:void(0)' onclick='showrowname(\""+row.code+"\",\""+row.name+"\")' style='color:blue;'>查看</a>";
            }

            function showrowname(code , name){
                alert( code +  name );

            }

            //创建一个组件对象
            var treeGrid = new TreeGrid(config);
            treeGrid.show();

            /*
                展开、关闭所有节点。
                isOpen=Y表示展开，isOpen=N表示关闭
            */
            function expandAll(isOpen){
                treeGrid.expandAll(isOpen);
            }

            /*
                取得当前选中的行，方法返回TreeGridItem对象
            */
            function selectedItem(){
                var treeGridItem = treeGrid.getSelectedItem();
                if(treeGridItem!=null){
                    //获取数据行属性值
                    //alert(treeGridItem.id + ", " + treeGridItem.index + ", " + treeGridItem.data.name);

                    //获取父数据行
                    var parent = treeGridItem.getParent();
                    if(parent!=null){
                        //jQuery("#currentRow").val(parent.data.name);
                    }

                    //获取子数据行集
                    var children = treeGridItem.getChildren();
                    if(children!=null && children.length>0){
                        jQuery("#currentRow").val(children[0].data.name);
                    }
                }
            }
        </script>
    </div>
</body>
</html>
