<script type="text/javascript">
  $(function () {
    $('a.unbind').click(function () {
      $('#user_id_card, .id-card, #user_user_sign').val('');
      $('img#ca-sign').attr('src', '');
      $('.id-card').html("<b class='text-danger'>无</b>");
      return false;
    });
    $('.pass-request').click(function () {
      var o = $(this);
      if (o.hasClass('pass')) {
        $('#account-pass-flag').val(1);
      } else if (o.hasClass('deny')) {
        $('#account-pass-flag').val(0);
      }
    });
  });
</script>
<div class="row" style="margin: 0;">
  <div class="col-sm-6 col-sm-offset-3">
    <%= form_for(@user) do |f| %>
        <script>
          $(document).ready(function () {
            $(".region").ProvinceCity({
              dprovince: "<%= @user.user_s_province %>",
              dcity: "<%= @user.prov_city %>",
              lcity: "<%= @user.prov_country %>"
            });
          });
        </script>
        <div class="text-danger"><%= flash[:notice] %></div>
        <% if @user.new_record? %>
            <h4>创建用户</h4>
        <% else %>
            <h4>修改用户</h4>
        <% end %>
        <hr>
        <label for="">UID：<%= @user.uid %>(<%= @user.func_type_desc %>)</label><br>
        <% if @user.new_record? %>
            <label>请输入用户名：</label>
            <%= f.text_field :name, :class => 'form-control input-sm' %>
        <% else %>
            <label>用户名：<%= @user.name %></label>
            <br>
        <% end %>

        <% unless @user.user_sign.blank? %>
            <label for="">CA签名：</label>
            <img id="ca-sign" src="data:image/png;base64,<%= @user.user_sign %>" alt="签名"><br><br>
            <%= f.hidden_field :user_sign, :class => "form-control input-sm" %>
        <% end %>

        <br>
        <label>请输入密码：<%= show_error(@user.errors, :password) %></label>
        <%= f.password_field :password, :class => "form-control input-sm" %>

        <br>
        <label>请再次输入密码：</label>
        <%= f.password_field :password_confirmation, :class => "form-control input-sm" %>

        <br>
        <label>姓名：</label>
        <%= f.text_field :tname, :class => "form-control input-sm" %>

        <br>
        <label>身份证号：</label><span class="id-card"><%= @user.id_card.blank? ? '无' : @user.id_card %></span><a class="btn text-danger btn-xs unbind" href="">解绑</a>
        <br>
        <%= f.hidden_field :id_card, :class => "form-control input-sm" %>

        <br>
        <label>联系电话：</label>
        <%= f.text_field :tel, :class => "form-control input-sm" %>

        <br>
        <label>手机号：</label>
        <%= f.text_field :mobile, :class => "form-control input-sm" %>

        <br>
        <label>电子邮箱：</label>
        <%= f.text_field :eaddress, :class => "form-control input-sm" %>

        <% if current_user.name == 'superadmin' %>
            <br>
            <label>所在省份：</label>

            <div class="region form-inline">
              <%= f.select :user_s_province, '', {}, :class => "form-control input-sm", :id => "province" %>
              <%= f.select :user_s_city, '', {}, :class => "form-control input-sm", :id => "city" %>
              <%= f.select :user_s_lcity, '', {}, :class => "form-control input-sm", :id => "lcity" %>
            </div>
        <% end %>

        <br>
        <% if current_user.id == @user.id %>
            <label for="">机构名称：<%= @user.jg_bsb.jg_name %></label>
        <% else %>
            <label>机构名称：</label>
            <%= f.select :jg_bsb_id, options_for_select(JgBsb.where(status: 0).map { |jg| [jg.jg_name, jg.id] }, @user.jg_bsb_id), {}, :class => "form-control input-sm" %>

            <div class="form-inline">
              <div class="checkbox">
                <label><%= f.check_box :is_account_manager, options = {}, checked_value = "1", unchecked_value = "0" %>
                  是否为机构账号管理员</label></div>
            </div>
        <% end %>

        <% if current_user.name == 'superadmin' %>
            <div class="checkbox">
              <label><%= f.check_box :user_i_switch, options = {}, checked_value = "1", unchecked_value = "0" %>
                是否为工作组</label></div>
            <%= f.select :user_s_dl, options_for_select(ACategory::Category24.map { |c| [c, c] }.unshift(['请选择', '']), @user.user_s_dl), {}, :class => "form-control input-sm" %>
            <br>

            <div class="form-inline">
              <div class="checkbox">
                <label><%= f.check_box :user_i_js, options = {}, checked_value = "1", unchecked_value = "0" %>
                  是否为地方药监局</label></div>
              <div class="checkbox">
                <label><%= f.check_box :user_i_spys, options = {}, checked_value = "1", unchecked_value = "0" %>
                  是否为食品一司</label></div>
              <div class="checkbox">
                <label><%= f.check_box :user_i_spss, options = {}, checked_value = "1", unchecked_value = "0" %>
                  是否为食品三司</label></div>
            </div>
            <br>

            <div class="panel panel-default">
              <div class="panel-body">
                <label>数据库查看权限设置:</label>
                <br>
                <!--div class="checkbox">
            <label >
            <%= f.check_box :user_i_bjp, options = {}, checked_value = "1", unchecked_value = "0" %>保健食品
            </label>
          </div>
          <div class="checkbox"><label >
            <%= f.check_box :user_i_hzp, options = {}, checked_value = "1", unchecked_value = "0" %>化妆品
          </label></div-->
                <div class="checkbox"><label>
                  <%= f.check_box :user_i_sp, options = {}, checked_value = "1", unchecked_value = "0" %>食品</span>
                </label></div>
                <hr style="margin: 10px auto;">
                <div class="checkbox"><label>
                  <%= f.check_box :user_d_authority, options = {}, checked_value = "1", unchecked_value = "0" %>填报基本信息
                </label></div>
                <div class="checkbox"><label>
                  <%= f.check_box :user_d_authority_1, options = {}, checked_value = "1", unchecked_value = "0" %>填报检测数据
                </label></div>
                <div class="checkbox"><label>
                  <%= f.check_box :user_d_authority_2, options = {}, checked_value = "1", unchecked_value = "0" %>上报审核
                </label></div>
                <div class="checkbox"><label>
                  <%= f.check_box :user_d_authority_5, options = {}, checked_value = "1", unchecked_value = "0" %>上报批准
                </label></div>
                <!--div class="checkbox"><label>
                  <%= f.check_box :user_d_authority_3, options = {}, checked_value = "1", unchecked_value = "0" %>问题样品处理
                </label></div>
                <div class="checkbox"><label>
                  <%= f.check_box :user_d_authority_4, options = {}, checked_value = "1", unchecked_value = "0" %>统计分析
                </label></div-->
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <label>异议管理权限:</label>
                <br>

                <div class="form-inline">
                  <div class="checkbox">
                    <label><%= f.check_box :yyadmin, options = {}, checked_value = "1", unchecked_value = "0" %>
                      管理员</label>
                  </div>
                  <div class="checkbox">
                    <label><%= f.check_box :yysl, options = {}, checked_value = "1", unchecked_value = "0" %>
                      异议受理</label>
                  </div>
                  <div class="checkbox">
                    <label><%= f.check_box :zhxt, options = {}, checked_value = "1", unchecked_value = "0" %>
                      综合协调</label>
                  </div>
                  <div class="checkbox">
                    <label><%= f.check_box :yybl, options = {}, checked_value = "1", unchecked_value = "0" %>
                      异议办理</label>
                  </div>
                  <div class="checkbox">
                    <label><%= f.check_box :yysh, options = {}, checked_value = "1", unchecked_value = "0" %>
                      异议审核</label>
                  </div>
                </div>
                <br>
                <br>
                <label>后处理权限:</label>
                <!--span>
            <%= f.check_box :hcz_sc, options = {}, checked_value = "1", unchecked_value = "0" %>生产
            <%= f.check_box :hcz_lt, options = {}, checked_value = "1", unchecked_value = "0" %>流通
          </span-->
                <br>

                <div class="form-inline">
                  <div class="checkbox">
                    <label><%= f.check_box :hcz_admin, options = {}, checked_value = "1", unchecked_value = "0" %>
                      管理员</label>
                  </div>
                  <div class="checkbox">
                    <label> <%= f.check_box :hcz_czap, options = {}, checked_value = "1", unchecked_value = "0" %>
                      处置安排 </label>
                  </div>
                  <div class="checkbox">
                    <label><%= f.check_box :hcz_czbl, options = {}, checked_value = "1", unchecked_value = "0" %>
                      处置办理</label>
                  </div>
                  <div class="checkbox">
                    <label><%= f.check_box :hcz_czsh, options = {}, checked_value = "1", unchecked_value = "0" %>
                      处置审核</label>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <label>抽检终端权限</label>
                <br>

                <div class="form-inline">
                  <div class="checkbox"><label><%= f.check_box :jsyp %>接收样品</label></div>
                  &emsp;
                  <div class="checkbox"><label><%= f.check_box :zxcy %>执行采样任务</label></div>
                  &emsp;
                  <div class="checkbox"><label><%= f.check_box :rwbs %>任务部署</label></div>
                  &emsp;
                  <div class="checkbox"><label><%= f.check_box :rwxd %>任务下达</label></div>
                </div>
                <br>
                <br>
                <label>系统编号：<!--<i class="text-danger">目前仅限吉林省用</i>--></label>
                <%= f.text_field :car_sys_id, :class => "form-control input-sm" %>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-body">
                <label>抽检数据发布</label>
                <br>

                <div class="form-inline">
                  <div class="checkbox"><label><%= f.check_box :pub_xxfb %>信息发布</label></div>
                  &emsp;
                  <div class="checkbox"><label><%= f.check_box :pub_xxfb_sh %>信息发布审核</label></div>
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">其他</div>
              <div class="panel-body">
                <%= f.check_box :enable_api, options = {}, checked_value = "1", unchecked_value = "0" %>是否启用接口
              </div>
            </div>
        <% end %>
        <br>
        <% if @user.enabled_at.nil? %>
            <input type="hidden" name="account-pass-request" value="1">
            <input type="hidden" name="account-pass" id="account-pass-flag">
            <button class="btn btn-sm btn-success pass pass-request" data-confirm="确定审核通过该账号吗？">
              <i class="glyphicon glyphicon-ok"></i>&nbsp;审核通过
            </button>
            <button class="btn btn-sm btn-danger deny pass-request" data-confirm="确定决绝该账号的申请吗？">拒绝申请</button>
        <% else %>
            <button class="btn btn-sm btn-success" data-confirm="确定保存吗？">提交</button>
        <% end %>
        <%= link_to '返回', users_path, :class => 'btn btn-sm btn-info' %>
    <% end %>
  </div>
</div>
